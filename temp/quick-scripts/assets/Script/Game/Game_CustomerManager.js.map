{"version":3,"sources":["Game_CustomerManager.js"],"names":["cc","Class","extends","Component","properties","customer","lineUpPos","bubble","onLoad","Array","i","length","node","getChildByName","active","Vec2","x","y","bubbleLocPos","moveTime","setSpeed","speed","initCunstomer","onFinish","currentCustomer","getRandomCustomer","getComponent","setTo","moveForward","satisfyCustomer","moodLevel","setMood","parent","position","pos","moveTo","bubbleNode","destroy","gold","parseInt","rd","Math","random","instantiate","setSiblingIndex","index","scheduleOnce"],"mappings":"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","file":"Game_CustomerManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Game","sourcesContent":["\r\ncc.Class({\r\n\textends: cc.Component,\r\n\r\n\tproperties: {\r\n\t\tcustomer: [], // 所有顾客对象\r\n\t\tlineUpPos: [], // 队伍上的点位\r\n\t\tbubble: null,\r\n\t},\r\n\r\n\tonLoad() {\r\n\t\tthis.customer = new Array(8);\r\n\t\tthis.lineUpPos = new Array(8);\r\n\t\tfor (var i = 0; i < this.customer.length; i++) {\r\n\t\t\tthis.customer[i] = this.node.getChildByName(\"ch_role\" + i);\r\n\t\t\tthis.customer[i].active = false;\r\n\t\t\tthis.lineUpPos[i] = new cc.Vec2(this.customer[i].x, this.customer[i].y);\r\n\t\t}\r\n\r\n\t\tthis.bubble = this.node.getChildByName(\"add_bubble\");\r\n\t\tthis.bubble.active = false;\r\n\t\tthis.bubbleLocPos = new cc.Vec2(18, 24);\r\n\r\n\t\t//this.moveSpeed = 1; // 移动速度\r\n\t\tthis.moveTime = 1; // 移动时间\r\n\r\n\t\t//cc.log(this.customer[0].getComponent(\"Game_Customer\").gold);\r\n\t\t//var customer = this.customer[0].getComponent(\"Game_Customer\");\r\n\t\t//customer.setTo(30, 55);\r\n\t\t//customer.moveTo(1, 30, 35, ()=> {cc.log(\"finish..\")});\r\n\t\t//this.initCunstomer();\r\n\t},\r\n\r\n\t// 移动速度\r\n\tsetSpeed(speed) {\r\n\t\tif (speed > 0) {\r\n\t\t\tthis.moveTime = 1 / speed;\r\n\t\t}\r\n\t},\r\n\r\n\t// 初始化顾客\r\n\tinitCunstomer(onFinish) {\r\n\t\tthis.currentCustomer = new Array(6); // 当前队列上的顾客\r\n\t\tfor (var i = 0; i < this.currentCustomer.length; i++) {\r\n\t\t\tthis.currentCustomer[i] = this.getRandomCustomer();\r\n\t\t\tthis.currentCustomer[i].getComponent(\"Game_Customer\").setTo(this.lineUpPos[i + 1].x, this.lineUpPos[i + 1].y);\r\n\t\t}\r\n\t\t// 往前移动\r\n\t\tthis.moveForward(onFinish);\r\n\t},\r\n\r\n\t// 一个顾客离开 moodLevel: 0愤怒 1平静 2开心\r\n\tsatisfyCustomer(moodLevel, onFinish) {\r\n\t\t// 添加mood\r\n\t\tthis.bubble.active = true;\r\n\t\tthis.bubble.getComponent(\"Game_Bubble\").setMood(moodLevel);\r\n\t\tthis.bubble.parent = this.currentCustomer[0];\r\n\t\tthis.bubble.position = this.bubbleLocPos;\r\n\t\t// 第一个离开\r\n\t\tlet pos = this.currentCustomer[0].position;\r\n\t\tlet customer = this.currentCustomer[0].getComponent(\"Game_Customer\");\r\n\t\tcustomer.moveTo(this.moveTime * 2, pos.x + 120, pos.y, () => {\r\n\t\t\tlet bubbleNode = customer.node.getChildByName(\"add_bubble\");\r\n\t\t\tif (bubbleNode != null) { // 下一个顾客提前把气泡拿走使用了，上一个顾客销毁时就不需要处理气泡了\r\n\t\t\t\tbubbleNode.parent = this.node;\r\n\t\t\t\tbubbleNode.active = false;\r\n\t\t\t}\r\n\t\t\tcustomer.node.destroy();\r\n\t\t});\r\n\t\t// 队列往前排一个，并在最后新建一个\r\n\t\tfor (var i = 0; i < this.currentCustomer.length - 1; i++) {\r\n\t\t\tthis.currentCustomer[i] = this.currentCustomer[i + 1];\r\n\t\t}\r\n\t\tthis.currentCustomer[i] = this.getRandomCustomer();\r\n\t\tthis.currentCustomer[i].getComponent(\"Game_Customer\").setTo(this.lineUpPos[i + 1].x, this.lineUpPos[i + 1].y);\r\n\t\t// 往前移动\r\n\t\tthis.moveForward(onFinish);\r\n\r\n\t\t// 得分\r\n\t\tif (moodLevel == 2) {\r\n\t\t\treturn customer.gold;\r\n\t\t} else if (moodLevel == 1) {\r\n\t\t\treturn parseInt(customer.gold * 0.7);\r\n\t\t} else {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t},\r\n\r\n\t// 随机取一个客户\r\n\tgetRandomCustomer() {\r\n\t\tlet rd = parseInt(Math.random() * this.customer.length);\r\n\t\tlet node = cc.instantiate(this.customer[rd]);\r\n\t\tnode.active = true;\r\n\t\tnode.parent = this.node;\r\n\t\tnode.setSiblingIndex(0);\r\n\t\treturn node;\r\n\t},\r\n\r\n\t// 向前移动一个位置\r\n\tmoveForward(onFinish) {\r\n\t\tfor (var i = 0; i < this.currentCustomer.length; i++) {\r\n\t\t\tlet customer = this.currentCustomer[i].getComponent(\"Game_Customer\");\r\n\t\t\tlet index = i;\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tcustomer.moveTo(this.moveTime, this.lineUpPos[index].x, this.lineUpPos[index].y, () => {\r\n\t\t\t\t\tif (index == this.currentCustomer.length - 1) {\r\n\t\t\t\t\t\tonFinish();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}, i * 0.3);\r\n\t\t}\r\n\t},\r\n\r\n\t// update (dt) {},\r\n});\r\n"]}