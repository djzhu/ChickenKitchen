{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\Game/assets\\Script\\Game\\Game_CustomerManager.js"],"names":["cc","Class","extends","Component","properties","customer","lineUpPos","bubble","onLoad","Array","i","length","node","getChildByName","active","Vec2","x","y","bubbleLocPos","moveTime","getRandomCustomer","rd","parseInt","Math","random","instantiate","parent","setSiblingIndex","moveForward","currentCustomer","getComponent","index","scheduleOnce","moveTo","initCunstomer","setTo","satisfyCustomer","moodLevel","setMood","position","pos","bubbleNode","destroy","gold"],"mappings":"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","file":"Game_CustomerManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Game","sourcesContent":["\r\ncc.Class({\r\n\textends: cc.Component,\r\n\r\n\tproperties: {\r\n\t\tcustomer: [], // 所有顾客对象\r\n\t\tlineUpPos: [], // 队伍上的点位\r\n\t\tbubble: null,\r\n\t},\r\n\r\n\tonLoad() {\r\n\t\tthis.customer = new Array(8);\r\n\t\tthis.lineUpPos = new Array(8);\r\n\t\tfor (var i = 0; i < this.customer.length; i++) {\r\n\t\t\tthis.customer[i] = this.node.getChildByName(\"ch_role\" + i);\r\n\t\t\tthis.customer[i].active = false;\r\n\t\t\tthis.lineUpPos[i] = new cc.Vec2(this.customer[i].x, this.customer[i].y);\r\n\t\t}\r\n\r\n\t\tthis.bubble = this.node.getChildByName(\"add_bubble\");\r\n\t\tthis.bubble.active = false;\r\n\t\tthis.bubbleLocPos = new cc.Vec2(18, 24);\r\n\r\n\t\t//this.moveSpeed = 1; // 移动速度\r\n\t\tthis.moveTime = 1; // 移动时间\r\n\r\n\t\t//cc.log(this.customer[0].getComponent(\"Game_Customer\").gold);\r\n\t\t//var customer = this.customer[0].getComponent(\"Game_Customer\");\r\n\t\t//customer.setTo(30, 55);\r\n\t\t//customer.moveTo(1, 30, 35, ()=> {cc.log(\"finish..\")});\r\n\t\t//this.initCunstomer();\r\n\t},\r\n\r\n\t// 随机取一个客户\r\n\tgetRandomCustomer() {\r\n\t\tlet rd = parseInt(Math.random() * this.customer.length);\r\n\t\tlet node = cc.instantiate(this.customer[rd]);\r\n\t\tnode.active = true;\r\n\t\tnode.parent = this.node;\r\n\t\tnode.setSiblingIndex(0);\r\n\t\treturn node;\r\n\t},\r\n\r\n\t// 向前移动一个位置\r\n\tmoveForward() {\r\n\t\tfor (var i = 0; i < this.currentCustomer.length; i++) {\r\n\t\t\tlet customer = this.currentCustomer[i].getComponent(\"Game_Customer\");\r\n\t\t\tlet index = i;\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tcustomer.moveTo(this.moveTime, this.lineUpPos[index].x, this.lineUpPos[index].y, () => { });\r\n\t\t\t}, i * 0.3);\r\n\t\t}\r\n\t},\r\n\r\n\t// 初始化顾客\r\n\tinitCunstomer() {\r\n\t\tthis.currentCustomer = new Array(6); // 当前队列上的顾客\r\n\t\tfor (var i = 0; i < this.currentCustomer.length; i++) {\r\n\t\t\tthis.currentCustomer[i] = this.getRandomCustomer();\r\n\t\t\tthis.currentCustomer[i].getComponent(\"Game_Customer\").setTo(this.lineUpPos[i + 1].x, this.lineUpPos[i + 1].y);\r\n\t\t}\r\n\t\t// 往前移动\r\n\t\tthis.moveForward();\r\n\t},\r\n\r\n\t// 一个顾客离开\r\n\tsatisfyCustomer(moodLevel) {\r\n\t\t// 添加mood\r\n\t\tthis.bubble.active = true;\r\n\t\tthis.bubble.getComponent(\"Game_Bubble\").setMood(moodLevel);\r\n\t\tthis.bubble.parent = this.currentCustomer[0];\r\n\t\tthis.bubble.position = this.bubbleLocPos;\r\n\t\t// 第一个离开\r\n\t\tlet pos = this.currentCustomer[0].position;\r\n\t\tlet customer = this.currentCustomer[0].getComponent(\"Game_Customer\");\r\n\t\tcustomer.moveTo(this.moveTime * 2, pos.x + 120, pos.y, () => {\r\n\t\t\tlet bubbleNode = customer.node.getChildByName(\"add_bubble\");\r\n\t\t\tif (bubbleNode != null) { // 下一个顾客提前把气泡拿走使用了，上一个顾客销毁时就不需要处理气泡了\r\n\t\t\t\tbubbleNode.parent = this.node;\r\n\t\t\t\tbubbleNode.active = false;\r\n\t\t\t}\r\n\t\t\tcustomer.node.destroy();\r\n\t\t});\r\n\t\t// 队列往前排一个，并在最后新建一个\r\n\t\tfor (var i = 0; i < this.currentCustomer.length - 1; i++) {\r\n\t\t\tthis.currentCustomer[i] = this.currentCustomer[i + 1];\r\n\t\t}\r\n\t\tthis.currentCustomer[i] = this.getRandomCustomer();\r\n\t\tthis.currentCustomer[i].getComponent(\"Game_Customer\").setTo(this.lineUpPos[i + 1].x, this.lineUpPos[i + 1].y);\r\n\t\t// 往前移动\r\n\t\tthis.moveForward();\r\n\r\n\t\t// 得分\r\n\t\tif (moodLevel == 2) {\r\n\t\t\treturn customer.gold;\r\n\t\t} else if (moodLevel == 1) {\r\n\t\t\treturn parseInt(customer.gold * 0.7);\r\n\t\t} else {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t},\r\n\r\n\t// update (dt) {},\r\n});\r\n"]}